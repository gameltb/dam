syntax = "proto3";

package flowcraft.v1.core;

import "google/protobuf/struct.proto";
import "flowcraft/v1/core/base.proto";
import "flowcraft/v1/actions/chat_actions.proto";

message ActionTemplate {
  string id = 1;
  string label = 2;
  repeated string menu_path = 3;
  ActionExecutionStrategy strategy = 4;
  google.protobuf.Struct params_schema = 5;
}

enum ActionExecutionStrategy {
  EXECUTION_IMMEDIATE = 0;
  EXECUTION_BACKGROUND = 1;
  EXECUTION_STREAMING = 2;
}

message ActionDiscoveryRequest {
  string node_id = 1;
  repeated string selected_node_ids = 2;
}

message ActionDiscoveryResponse {
  repeated ActionTemplate actions = 1;
}

message ActionExecutionRequest {
  string action_id = 1;
  string source_node_id = 2;
  repeated string context_node_ids = 3;
  
  oneof params {
    google.protobuf.Struct params_struct = 10;
    PromptGenParams prompt_gen = 11;
    NodeTransformParams transform = 12;
    ImageEnhanceParams enhance = 13;
    // 引用其他包时使用全路径
    flowcraft.v1.actions.ChatActionParams chat_generate = 14;
    flowcraft.v1.actions.ChatSyncBranchParams chat_sync = 15;
  }
}

// 具体 Action 参数定义
message ImageEnhanceParams {
  float strength = 1;
  string model_name = 2;
}

message NodeTransformParams {
  string instruction = 1;
  string style = 2;
}

message PromptGenParams {
  string prompt = 1;
  string negative_prompt = 2;
  int32 steps = 3;
  float cfg_scale = 4;
}